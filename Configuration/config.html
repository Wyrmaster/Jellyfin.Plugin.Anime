<!DOCTYPE html>
<html>
<head>
  <title>Anime</title>
</head>
<body>
<div id="configPage"
     data-role="page"
     class="page type-interior pluginConfigurationPage configPage"
     data-require="emby-input,emby-button,emby-checkbox">
  <div data-role="content">
    <div class="content-primary">
      <h1>Anime</h1>
      <form class="configForm">

        <div class="inputContainer">
          <input is="emby-input"
                 type="text"
                 id="anilistGraphQLEndpoint"
                 label="Anilist GraphQL Endpoint" />
          <div class="fieldDescription">Endpoint of the GraphQL Interface</div>
        </div>
        <div class="inputContainer">
          <input is="emby-input"
                 type="text"
                 id="jikanEndpoint"
                 label="Jikan Endpoint" />
          <div class="fieldDescription">Endpoint for the Jikan Server</div>
        </div>

        <div>
          <button is="emby-button"
                  type="submit"
                  class="raised button-submit block">
            <span>Save</span>
          </button>
        </div>

      </form>
    </div>
  </div>
  <script type="text/javascript">
    var PluginConfig = {
      pluginId: "597c0d6e-2e91-402d-be34-54b67c4a5da2"
    };

    document.querySelector('.configPage')
      .addEventListener('pageshow', function () {
        Dashboard.showLoadingMsg();
        ApiClient.getPluginConfiguration(PluginConfig.pluginId).then(function (config) {

          const jikanUrl = document.querySelector('#anilistGraphQLEndpoint');
          const jikanEndPoint = document.querySelector('#jikanEndpoint');
          jikanUrl.value = config.AniListEndpoint;
          jikanEndPoint.value = config.JikanEndpoint;
          jikanUrl.dispatchEvent(new Event('change', {
            bubbles: true,
            cancelable: false
          }));

          Dashboard.hideLoadingMsg();
        });
      });

    document.querySelector('.configForm')
      .addEventListener('submit', function (e) {
        Dashboard.showLoadingMsg();

        ApiClient.getPluginConfiguration(PluginConfig.pluginId).then(function (config) {
          config.AniListEndpoint = document.querySelector('#anilistGraphQLEndpoint').value;
          config.JikanEndpoint = document.querySelector('#jikanEndpoint').value;

          ApiClient.updatePluginConfiguration(PluginConfig.pluginId, config).then(Dashboard.processPluginConfigurationUpdateResult);
        });

        e.preventDefault();
        return false;
      });
  </script>
</div>
</body>
</html>